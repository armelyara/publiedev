<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml" href="/assets/icons/favicon.svg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
    <title>Tracer une DevRoute - PublieDev</title>
</head>

<body>
    <header class="header">
        <div class="container header-content">
            <a href="/" class="logo">
                <div class="logo-icon">
                    <img src="/assets/icons/logo.png" alt="PublieDev" width="20" height="20">
                </div>
                <span>PublieDev</span>
            </a>
            <nav class="nav desktop-only">
                <a href="/pages/explore.html">Explorer</a>
                <div id="authNav">
                    <a href="/pages/login.html" class="btn btn-primary">Connexion</a>
                </div>
            </nav>
        </div>
    </header>

    <main>
        <div class="container" style="padding: 2rem 1rem;">
            <div style="max-width: 54rem; margin: 0 auto;">
                <h1 style="font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem;">Tracer une nouvelle DevRoute</h1>
                <p style="color: var(--gray-600); margin-bottom: 2rem; font-size: 1.1rem;">
                    Documentez votre itin√©raire technique : du probl√®me initial √† la solution d√©ploy√©e.
                    <br><small>‚ö†Ô∏è Rappel : M√©thode "Bo√Æte Noire". D√©crivez la logique, ne soumettez jamais votre code source.</small>
                    <br><small>‚ö†Ô∏è Rappel : M√©thode "Bo√Æte Noire". D√©crivez la logique, ne soumettez jamais votre code
                        source.</small>
                </p>

                <div id="loadingState" style="text-align: center; padding: 4rem 2rem;">
                    <p style="color: var(--gray-500);">Chargement...</p>
                </div>

                <div id="authRequired" style="display: none; text-align: center; padding: 4rem 2rem;">
                    <h2 style="margin-bottom: 1rem;">Connexion requise</h2>
                    <p style="color: var(--gray-600); margin-bottom: 1.5rem;">Vous devez √™tre connect√© pour tracer une
                        DevRoute.</p>
                    <a href="/pages/login.html" class="btn btn-primary">Se connecter</a>
                </div>

                <form id="publishForm" style="display: none;">
                    <div id="errorAlert" class="alert alert-error" style="display: none;"></div>
                    <div id="successAlert" class="alert alert-success" style="display: none;"></div>

                    <div
                        style="background: var(--white); border-radius: 0.75rem; padding: 2rem; margin-bottom: 2rem; border: 1px solid var(--gray-200); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);">
                        <h3
                            style="font-weight: 700; font-size: 1.25rem; margin-bottom: 1.5rem; color: var(--gray-800); border-bottom: 1px solid var(--gray-100); padding-bottom: 0.5rem;">
                            üìã Identit√© du Projet
                        </h3>

                        <div class="form-group">
                            <label for="title" style="font-weight: 600;">Titre du Projet *</label>
                            <input type="text" id="title" placeholder="Ex: TraficDay - Assistant routier temps r√©el"
                                required style="font-size: 1.1rem; padding: 0.75rem;">
                        </div>

                        <div class="form-group">
                            <label for="category" style="font-weight: 600;">Cat√©gorie Principale *</label>
                            <select id="category" required
                                style="width: 100%; padding: 0.75rem; border: 1px solid var(--gray-300); border-radius: 0.5rem; background: var(--white);">
                                <option value="">Choisir un secteur...</option>
                                <option value="fintech">Fintech & Mobile Money</option>
                                <option value="agritech">AgriTech</option>
                                <option value="healthtech">Sant√© & E-Sant√©</option>
                                <option value="edtech">√âducation & Formation</option>
                                <option value="ecommerce">E-commerce & Logistique</option>
                                <option value="transport">Transport & Smart City</option>
                                <option value="govtech">Services Publics (GovTech)</option>
                                <option value="ai-data">IA & Data Science</option>
                                <option value="devtools">Outils D√©veloppeurs (Libs/SDK)</option>
                                <option value="entertainment">Divertissement & Culture</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="tags" style="font-weight: 600;">Stack Technique (Tags) *</label>
                            <input type="text" id="tags" placeholder="Ex: Flutter, Firebase, API Orange Money, YOLOv8"
                                required>
                            <small style="color: var(--gray-500);">3 √† 8 mots-cl√©s s√©par√©s par des virgules.</small>
                        </div>

                        <div class="form-group" style="margin-bottom: 0;">
                            <label for="synopsis" style="font-weight: 600;">Synopsis (Accroche) *</label>
                            <textarea id="synopsis" rows="2" maxlength="280"
                                placeholder="Le 'Pitch' technique. R√©sumez votre solution en 2 phrases pour les r√©sultats de recherche."
                                required></textarea>
                            <small style="display: block; text-align: right; color: var(--gray-500);"><span
                                    id="synopsisCount">0</span>/280</small>
                        </div>
                    </div>

                    <!-- Champs sp√©cifiques App Mobile -->
                    <div id="appMobileFields" class="type-fields" style="display: none;">
                        <!-- M√âTADONN√âES -->
                        <div style="background: var(--white); border-radius: 0.75rem; padding: 1.5rem; border: 1px solid var(--gray-100); margin-bottom: 1.5rem;">
                            <h3 style="font-weight: 600; margin-bottom: 1rem;">üìã M√âTADONN√âES (Pour le Moteur de Recherche)</h3>

                            <div class="form-group">
                                <label for="mobileCategory" style="font-weight: 600;">Cat√©gorie Principale *</label>
                                <select id="mobileCategory" required style="padding: 0.75rem;">
                                    <option value="">Choisir un secteur...</option>
                                    <option value="fintech">Fintech & Mobile Money</option>
                                    <option value="agritech">AgriTech</option>
                                    <option value="healthtech">Sant√© & E-Sant√©</option>
                                    <option value="edtech">√âducation & Formation</option>
                                    <option value="ecommerce">E-commerce & Logistique</option>
                                    <option value="transport">Transport & Smart City</option>
                                    <option value="govtech">Services Publics (GovTech)</option>
                                    <option value="ai-data">IA & Data Science</option>
                                    <option value="devtools">Outils D√©veloppeurs (Libs/SDK)</option>
                                    <option value="entertainment">Divertissement & Culture</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="mobileSynopsis">Synopsis Technique (Max 280 caract√®res) *</label>
                                <textarea id="mobileSynopsis" rows="3" maxlength="280" placeholder="R√©sumez votre solution en une phrase pour les r√©sultats de recherche." required></textarea>
                                <small style="color: var(--gray-500); display: block; margin-top: 0.25rem;"><span id="mobileSynopsisCount">0</span>/280 caract√®res</small>
                            </div>

                            <div class="form-group" style="margin-bottom: 0;">
                                <label for="mobileTags">Stack Technique (Tags s√©par√©s par des virgules) *</label>
                                <input type="text" id="mobileTags" placeholder="Ex: Flutter, Firebase, Google Maps API, Docker" required>
                                <small style="color: var(--gray-500); display: block; margin-top: 0.25rem;">Entrez les technologies utilis√©es, s√©par√©es par des virgules</small>
                            </div>
                        </div>

                        <!-- √âTAPE 1: LE POINT DE D√âPART -->
                        <div style="background: var(--white); border-radius: 0.75rem; padding: 1.5rem; border: 1px solid var(--gray-100); margin-bottom: 1.5rem;">
                            <h3 style="font-weight: 600; margin-bottom: 0.5rem;">üéØ √âTAPE 1 : LE POINT DE D√âPART (Le Pourquoi)</h3>
                            <p style="color: var(--gray-600); font-size: 0.875rem; margin-bottom: 1rem;">Le contexte m√©tier</p>

                            <div class="form-group" style="margin-bottom: 0;">
                                <label for="mobileDeparture">Le Probl√®me / Besoin *</label>
                                <textarea id="mobileDeparture" rows="6" placeholder="Quel probl√®me pr√©cis avez-vous identifi√© ? Quel √©tait le contexte avant votre solution ?" required></textarea>
                            </div>
                        </div>

                        <!-- √âTAPE 2: LE V√âHICULE & LA CARTE -->
                        <div style="background: var(--white); border-radius: 0.75rem; padding: 1.5rem; border: 1px solid var(--gray-100); margin-bottom: 1.5rem;">
                            <h3 style="font-weight: 600; margin-bottom: 0.5rem;">üöó √âTAPE 2 : LE V√âHICULE & LA CARTE (Le Comment)</h3>
                            <p style="color: var(--gray-600); font-size: 0.875rem; margin-bottom: 1rem;">Le c≈ìur technique "Bo√Æte Noire"</p>

                            <div class="form-group">
                                <label for="mobileRoadmap">Architecture & Logique *</label>
                                <textarea id="mobileRoadmap" rows="8" placeholder="‚ö†Ô∏è Ne collez pas de code. Expliquez comment les technologies interagissent. (Ex: 'Le front envoie X au back qui traite Y...')" required></textarea>
                                <small style="color: var(--orange-600); display: block; margin-top: 0.25rem;">‚ö†Ô∏è Pas de code source - expliquez l'architecture en langage naturel</small>
                            </div>

                            <div class="form-group" style="margin-bottom: 0;">
                                <label for="mobileArchitectureDiagram">Sch√©ma d'Architecture (Image)</label>
                                <input type="file" id="mobileArchitectureDiagram" accept="image/*">
                                <small style="color: var(--gray-500); display: block; margin-top: 0.25rem;">T√©l√©chargez votre diagramme (UML, dessin, sch√©ma). Tr√®s recommand√©.</small>
                            </div>
                        </div>

                        <!-- √âTAPE 3: LES OBSTACLES -->
                        <div style="background: var(--white); border-radius: 0.75rem; padding: 1.5rem; border: 1px solid var(--gray-100); margin-bottom: 1.5rem;">
                            <h3 style="font-weight: 600; margin-bottom: 0.5rem;">‚ö†Ô∏è √âTAPE 3 : LES OBSTACLES (Le Processus)</h3>
                            <p style="color: var(--gray-600); font-size: 0.875rem; margin-bottom: 1rem;">Ce qui fait de ceci un vrai retour d'exp√©rience</p>

                            <div class="form-group" style="margin-bottom: 0;">
                                <label for="mobileObstacles">D√©fis & Solutions *</label>
                                <textarea id="mobileObstacles" rows="6" placeholder="Sur quoi avez-vous bloqu√© ? (Bug tenace, limitation API, performance). Comment avez-vous r√©solu le probl√®me ?" required></textarea>
                            </div>
                        </div>

                        <!-- √âTAPE 4: LA DESTINATION -->
                        <div style="background: var(--white); border-radius: 0.75rem; padding: 1.5rem; border: 1px solid var(--gray-100); margin-bottom: 1.5rem;">
                            <h3 style="font-weight: 600; margin-bottom: 0.5rem;">üèÅ √âTAPE 4 : LA DESTINATION (Preuves & Impact)</h3>
                            <p style="color: var(--gray-600); font-size: 0.875rem; margin-bottom: 1rem;">La validation finale</p>

                            <div class="form-group">
                                <label for="mobileDestination">R√©sultats & Impact *</label>
                                <textarea id="mobileDestination" rows="4" placeholder="Qu'est-ce que la solution permet de faire aujourd'hui ? Donnez des chiffres si possible (Vitesse, Utilisateurs...)." required></textarea>
                            </div>

                            <div class="form-group">
                                <label for="mobileDemoLink">Lien de D√©mo (Live)</label>
                                <input type="url" id="mobileDemoLink" placeholder="Lien vers le Play Store, App Store ou vid√©o YouTube">
                                <small style="color: var(--gray-500); display: block; margin-top: 0.25rem;">Play Store, App Store, ou lien de d√©monstration</small>
                            </div>

                            <div class="form-group" style="margin-bottom: 0;">
                                <label for="mobileGallery">Galerie (Screenshots)</label>
                                <input type="file" id="mobileGallery" accept="image/*" multiple>
                                <small style="color: var(--gray-500); display: block; margin-top: 0.25rem;">Ajoutez 3 √† 5 captures d'√©cran de l'interface. Floutez les donn√©es sensibles.</small>
                            </div>
                        </div>
                    </div>

                    <!-- Champs sp√©cifiques App Web -->
                    <div id="appWebFields" class="type-fields" style="display: none;">
                        <!-- M√âTADONN√âES -->
                        <div style="background: var(--white); border-radius: 0.75rem; padding: 1.5rem; border: 1px solid var(--gray-100); margin-bottom: 1.5rem;">
                            <h3 style="font-weight: 600; margin-bottom: 1rem;">üìã M√âTADONN√âES (Pour le Moteur de Recherche)</h3>

                            <div class="form-group">
                                <label for="webCategory" style="font-weight: 600;">Cat√©gorie Principale *</label>
                                <select id="webCategory" required style="padding: 0.75rem;">
                                    <option value="">Choisir un secteur...</option>
                                    <option value="fintech">Fintech & Mobile Money</option>
                                    <option value="agritech">AgriTech</option>
                                    <option value="healthtech">Sant√© & E-Sant√©</option>
                                    <option value="edtech">√âducation & Formation</option>
                                    <option value="ecommerce">E-commerce & Logistique</option>
                                    <option value="transport">Transport & Smart City</option>
                                    <option value="govtech">Services Publics (GovTech)</option>
                                    <option value="ai-data">IA & Data Science</option>
                                    <option value="devtools">Outils D√©veloppeurs (Libs/SDK)</option>
                                    <option value="entertainment">Divertissement & Culture</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="webSynopsis">Synopsis Technique (Max 280 caract√®res) *</label>
                                <textarea id="webSynopsis" rows="3" maxlength="280" placeholder="R√©sumez votre solution en une phrase pour les r√©sultats de recherche." required></textarea>
                                <small style="color: var(--gray-500); display: block; margin-top: 0.25rem;"><span id="webSynopsisCount">0</span>/280 caract√®res</small>
                            </div>

                            <div class="form-group" style="margin-bottom: 0;">
                                <label for="webTags">Stack Technique (Tags s√©par√©s par des virgules) *</label>
                                <input type="text" id="webTags" placeholder="Ex: React, Node.js, MongoDB, AWS" required>
                                <small style="color: var(--gray-500); display: block; margin-top: 0.25rem;">Entrez les technologies utilis√©es, s√©par√©es par des virgules</small>
                            </div>
                    <div
                        style="background: var(--white); border-radius: 0.75rem; padding: 2rem; margin-bottom: 2rem; border: 1px solid var(--gray-200);">
                        <h3
                            style="font-weight: 700; font-size: 1.25rem; margin-bottom: 1.5rem; color: var(--bluesky-600);">
                            üéØ √âtape 1 : Le Point de D√©part
                        </h3>

                        <div class="form-group" style="margin-bottom: 0;">
                            <label for="step1_departure" style="font-weight: 600;">Le Probl√®me / Besoin *</label>
                            <textarea id="step1_departure" rows="5"
                                placeholder="Quel probl√®me m√©tier pr√©cis avez-vous identifi√© ? Quel √©tait le contexte avant votre solution ?"
                                required style="background: #fafafa;"></textarea>
                        </div>
                    </div>

                    <div
                        style="background: var(--white); border-radius: 0.75rem; padding: 2rem; margin-bottom: 2rem; border: 1px solid var(--gray-200);">
                        <h3
                            style="font-weight: 700; font-size: 1.25rem; margin-bottom: 1.5rem; color: var(--bluesky-600);">
                            üöó √âtape 2 : Le V√©hicule & La Carte
                        </h3>

                        <div class="form-group">
                            <label for="step2_roadmap" style="font-weight: 600;">Architecture & Logique (Bo√Æte Noire)
                                *</label>
                            <textarea id="step2_roadmap" rows="10"
                                placeholder="Comment avez-vous construit la solution ? Justifiez vos choix technologiques et expliquez le flux des donn√©es. &#10;‚ö†Ô∏è NE COLLEZ PAS DE CODE SOURCE."
                                required style="background: #fafafa;"></textarea>
                        </div>

                        <div class="form-group" style="margin-bottom: 0;">
                            <label for="architecture_diagram" style="font-weight: 600;">Sch√©ma d'Architecture
                                (Image)</label>
                            <div
                                style="border: 2px dashed var(--gray-300); padding: 2rem; text-align: center; border-radius: 0.5rem; background: var(--gray-50);">
                                <input type="file" id="architecture_diagram" accept="image/*" style="width: 100%;">
                                <p style="color: var(--gray-500); margin-top: 0.5rem; font-size: 0.9rem;">Diagramme UML,
                                    dessin ou sch√©ma logique (Recommand√©)</p>
                            </div>
                        </div>
                    </div>

                    <!-- Champs sp√©cifiques API -->
                    <div id="apiFields" class="type-fields" style="display: none;">
                        <!-- M√âTADONN√âES -->
                        <div style="background: var(--white); border-radius: 0.75rem; padding: 1.5rem; border: 1px solid var(--gray-100); margin-bottom: 1.5rem;">
                            <h3 style="font-weight: 600; margin-bottom: 1rem;">üìã M√âTADONN√âES (Pour le Moteur de Recherche)</h3>

                            <div class="form-group">
                                <label for="apiCategory" style="font-weight: 600;">Cat√©gorie Principale *</label>
                                <select id="apiCategory" required style="padding: 0.75rem;">
                                    <option value="">Choisir un secteur...</option>
                                    <option value="fintech">Fintech & Mobile Money</option>
                                    <option value="agritech">AgriTech</option>
                                    <option value="healthtech">Sant√© & E-Sant√©</option>
                                    <option value="edtech">√âducation & Formation</option>
                                    <option value="ecommerce">E-commerce & Logistique</option>
                                    <option value="transport">Transport & Smart City</option>
                                    <option value="govtech">Services Publics (GovTech)</option>
                                    <option value="ai-data">IA & Data Science</option>
                                    <option value="devtools">Outils D√©veloppeurs (Libs/SDK)</option>
                                    <option value="entertainment">Divertissement & Culture</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="apiSynopsis">Synopsis Technique (Max 280 caract√®res) *</label>
                                <textarea id="apiSynopsis" rows="3" maxlength="280" placeholder="R√©sumez votre solution en une phrase pour les r√©sultats de recherche." required></textarea>
                                <small style="color: var(--gray-500); display: block; margin-top: 0.25rem;"><span id="apiSynopsisCount">0</span>/280 caract√®res</small>
                            </div>

                            <div class="form-group" style="margin-bottom: 0;">
                                <label for="apiTags">Stack Technique (Tags s√©par√©s par des virgules) *</label>
                                <input type="text" id="apiTags" placeholder="Ex: Node.js, Express, PostgreSQL, Redis" required>
                                <small style="color: var(--gray-500); display: block; margin-top: 0.25rem;">Entrez les technologies utilis√©es, s√©par√©es par des virgules</small>
                            </div>
                    <div
                        style="background: var(--white); border-radius: 0.75rem; padding: 2rem; margin-bottom: 2rem; border: 1px solid var(--gray-200);">
                        <h3
                            style="font-weight: 700; font-size: 1.25rem; margin-bottom: 1.5rem; color: var(--orange-600);">
                            ‚ö†Ô∏è √âtape 3 : Les Obstacles
                        </h3>

                        <div class="form-group" style="margin-bottom: 0;">
                            <label for="step3_obstacles" style="font-weight: 600;">D√©fis & Solutions *</label>
                            <textarea id="step3_obstacles" rows="6"
                                placeholder="Sur quoi avez-vous bloqu√© ? (Bug tenace, limitation API, performance). Comment avez-vous r√©solu le probl√®me ? C'est ici que vous partagez votre exp√©rience r√©elle."
                                required style="background: #fffbf0;"></textarea>
                        </div>
                    </div>

                    <div
                        style="background: var(--white); border-radius: 0.75rem; padding: 2rem; margin-bottom: 2rem; border: 1px solid var(--gray-200);">
                        <h3
                            style="font-weight: 700; font-size: 1.25rem; margin-bottom: 1.5rem; color: var(--green-600);">
                            üèÅ √âtape 4 : La Destination
                        </h3>

                        <div class="form-group">
                            <label for="step4_destination" style="font-weight: 600;">R√©sultats & Impact *</label>
                            <textarea id="step4_destination" rows="4"
                                placeholder="Qu'est-ce que la solution permet de faire aujourd'hui ? Donnez des chiffres si possible (Vitesse, Utilisateurs, Stabilit√©)."
                                required></textarea>
                        </div>

                        <div class="form-group">
                            <label for="demo_link" style="font-weight: 600;">Lien de D√©mo / Live</label>
                            <input type="url" id="demo_link"
                                placeholder="https://play.google.com/... ou https://mon-site.com">
                        </div>

                        <div class="form-group" style="margin-bottom: 0;">
                            <label for="gallery" style="font-weight: 600;">Galerie (Screenshots)</label>
                            <input type="file" id="gallery" accept="image/*" multiple>
                            <small style="color: var(--gray-500); display: block; margin-top: 0.25rem;">Ajoutez 2 √† 5
                                captures d'√©cran. <strong>Floutez les donn√©es sensibles.</strong></small>
                        </div>
                    </div>

                    <div
                        style="display: flex; justify-content: flex-end; gap: 1rem; margin-top: 2rem; border-top: 1px solid var(--gray-200); padding-top: 2rem;">
                        <a href="/" class="btn btn-secondary">Annuler</a>
                        <button type="submit" class="btn btn-primary" id="submitBtn"
                            style="padding: 0.75rem 2rem; font-size: 1.1rem;">Soumettre ma DevRoute</button>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-storage-compat.js"></script>
    <script src="/js/config.js"></script>
    <script src="/js/services/firebase.js"></script>
    <script src="/js/services/auth.js"></script>

    <script>
        const form = document.getElementById('publishForm');
        const authRequired = document.getElementById('authRequired');
        const loadingState = document.getElementById('loadingState');
        const errorAlert = document.getElementById('errorAlert');
        const successAlert = document.getElementById('successAlert');
        const submitBtn = document.getElementById('submitBtn');
        const synopsisInput = document.getElementById('synopsis');
        const synopsisCount = document.getElementById('synopsisCount');

        let currentUser = null;

        // Gestion du compteur de caract√®res
        synopsisInput.addEventListener('input', () => {
            synopsisCount.textContent = synopsisInput.value.length;
        });

        // V√©rifier l'authentification
        auth.onAuthStateChanged((user) => {
            currentUser = user;
            loadingState.style.display = 'none';
            if (user) {
                form.style.display = 'block';
                authRequired.style.display = 'none';
            } else {
                form.style.display = 'none';
                authRequired.style.display = 'block';
            }
        });

        // Fonction helper pour l'upload d'image
        async function uploadFile(file, path) {
            const storageRef = storage.ref(path);
            await storageRef.put(file);
            return await storageRef.getDownloadURL();
        }

        // G√©n√©ration des mots-cl√©s pour la recherche
        function generateKeywords(text) {
            return text.toLowerCase()
                .normalize('NFD').replace(/[\u0300-\u036f]/g, '')
                .split(/\s+/)
                .filter(word => word.length > 2);
        }

        // SOUMISSION PRINCIPALE
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            errorAlert.style.display = 'none';
            successAlert.style.display = 'none';
            submitBtn.disabled = true;
            submitBtn.textContent = 'Envoi des donn√©es...';

            try {
                if (!currentUser) throw new Error('Authentification requise.');

                // 1. R√©cup√©ration des champs
                const title = document.getElementById('title').value.trim();
                const category = document.getElementById('category').value;
                const tagsRaw = document.getElementById('tags').value;
                const synopsis = document.getElementById('synopsis').value.trim();

                const step1 = document.getElementById('step1_departure').value.trim();
                const step2 = document.getElementById('step2_roadmap').value.trim();
                const step3 = document.getElementById('step3_obstacles').value.trim();
                const step4 = document.getElementById('step4_destination').value.trim();
                const demoLink = document.getElementById('demo_link').value.trim();

                // 2. Validation basique
                const tags = tagsRaw.split(',').map(t => t.trim().toLowerCase()).filter(t => t);
                if (tags.length < 3) throw new Error('Veuillez mettre au moins 3 tags techniques.');
                if (synopsis.length > 280) throw new Error('Le synopsis est trop long (max 280 caract√®res).');

                // 3. Uploads des Fichiers (S√©quentiel pour √©viter la surcharge)
                submitBtn.textContent = 'T√©l√©chargement des images...';

                let architectureDiagramUrl = null;
                const diagramFile = document.getElementById('architecture_diagram').files[0];
                if (diagramFile) {
                    architectureDiagramUrl = await uploadFile(diagramFile, `devroutes/${currentUser.uid}/${Date.now()}_arch_${diagramFile.name}`);
                }

                let galleryUrls = [];
                const galleryFiles = document.getElementById('gallery').files;
                if (galleryFiles.length > 0) {
                    for (let i = 0; i < galleryFiles.length; i++) {
                        const url = await uploadFile(galleryFiles[i], `devroutes/${currentUser.uid}/${Date.now()}_gallery_${i}`);
                        galleryUrls.push(url);
                    }
                }

                // 4. Construction de l'objet JSON (Structure DevRoute Valid√©e)
                const slug = title.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, '');

                const devRouteData = {
                    // M√âTADONN√âES RECHERCHE
                    meta_search: {
                        title: title,
                        slug: slug,
                        category: category,
                        tags: tags,
                        synopsis: synopsis,
                        keywords: generateKeywords(title + ' ' + category + ' ' + tags.join(' '))
                    },

                    // LE CONTENU DEVROUTE
                    content: {
                        step_1_departure: step1,
                        step_2_roadmap: step2,
                        step_3_obstacles: step3,
                        step_4_destination: step4,
                        media: {
                            architecture_diagram: architectureDiagramUrl,
                            demo_link: demoLink,
                            gallery: galleryUrls
                        }
                    },

                    // INFOS SYST√àME
                    author: {
                        uid: currentUser.uid,
                        name: currentUser.displayName || 'Utilisateur',
                        email: currentUser.email
                    },
                    status: 'pending', // En attente de validation
                    stats: { views: 0, likes: 0 },
                    certification: { status: 'none' }, // Pas encore certifi√©
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                // 5. Envoi √† Firestore
                submitBtn.textContent = 'Finalisation...';
                await db.collection('devroutes').add(devRouteData);

                // 6. Succ√®s
                successAlert.textContent = 'Votre DevRoute a √©t√© trac√©e avec succ√®s ! Elle est en cours de r√©vision par le comit√©.';
                successAlert.style.display = 'block';
                form.reset();
                window.scrollTo({ top: 0, behavior: 'smooth' });

            } catch (error) {
                console.error(error);
                errorAlert.textContent = error.message || 'Une erreur est survenue.';
                errorAlert.style.display = 'block';
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Soumettre ma DevRoute';
            }
        });
    </script>

    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-brand">
                    <a href="/" class="logo">
                        <div class="logo-icon">
                            <img src="/assets/icons/logo.png" alt="PublieDev" width="20" height="20">
                        </div>
                        <span>PublieDev</span>
                    </a>
                    <p>PublieDev, la revue technologique des d√©veloppeurs</p>
                </div>
                <div class="footer-links">
                    <h4>Ressources</h4>
                    <ul>
                        <li><a href="/pages/guidelines.html">Directives</a></li>
                        <li><a href="/pages/privacy.html">Confidentialit√©</a></li>
                        <li><a href="/pages/terms.html">Conditions</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 PublieDev. Le mot PublieDev ainsi que le logo sont des marques commerciales de <a
                        href="https://thedayinfo.com/">The Day Info</a>.</p>
            </div>
        </div>
    </footer>
</body>

</html>