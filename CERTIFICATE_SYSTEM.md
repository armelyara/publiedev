# Certificate System - PublieDev

## Overview

The certificate system provides **proof of existence** (preuve d'ant√©riorit√©) for approved publications on PublieDev. When a publication is approved, it automatically receives:

- **PDID** (PublieDev ID): Unique identifier in format `PDID-YYYY-XXXXXX`
- **SHA-256 Hash**: Cryptographic proof of immutable publication data
- **Timestamp**: Date and time of certificate generation
- **Certificate URL**: Link to view and print the certificate

## How It Works

### 1. Automatic Generation

When an admin approves a publication (status changes from `pending` to `approved`), the Firebase Function `generateCertificateOnApproval` is automatically triggered:

```
Publication Status: pending ‚Üí approved
        ‚Üì
Firebase Function Trigger
        ‚Üì
Generate PDID (with collision check)
        ‚Üì
Generate SHA-256 hash
        ‚Üì
Update publication document with certificate object
        ‚Üì
Certificate available
```

### 2. PDID Format

**Format**: `PDID-2025-X89Z2F`

- `PDID`: Prefix
- `2025`: Year of approval
- `X89Z2F`: 6 random characters (594M+ possible combinations)
- **Collision-resistant**: Uses 29-character alphabet excluding confusing chars (0/O, 1/I/L)

### 3. SHA-256 Hash

The hash is calculated from immutable publication data:

```javascript
{
  pdid: "PDID-2025-X89Z2F",
  title: "...",
  authorId: "...",
  authorName: "...",
  type: "...",
  category: "...",
  publishedAt: "...",
  description: "..." (first 500 chars)
}
```

**Why these fields?**
- They represent the core identity of the publication
- They don't change over time (unlike views, likes)
- They provide proof of "what was published when"

### 4. Database Structure

Certificate object is stored in the publication document:

```javascript
{
  // ... other publication fields
  certificate: {
    pdid: "PDID-2025-X89Z2F",
    hash: "d82c4998a129e62c7592b18c5045d20fa4f63f....",
    generated_at: Timestamp(2025-01-15 10:30:00),
    certificate_url: "https://publiedev.com/pages/certificate.html?pdid=PDID-2025-X89Z2F"
  }
}
```

## User Experience

### Viewing Certificates

1. **From Article Page**: "Voir le certificat" button (blue primary button)
2. **Direct URL**: `/pages/certificate.html?pdid=PDID-2025-X89Z2F`
3. **Publication Cards**: Small blue star badge indicates certificate available

### Certificate Page Features

- **Professional A4-like design** with watermark
- **Verification badge** (green checkmark)
- **Publication details**: Title, author, type, category, date
- **Cryptographic hash** displayed in monospace font
- **Print/Save as PDF**: Browser's native print dialog
- **Link to publication**: Quick access to full publication

### Certificate Actions

- üñ®Ô∏è **Print / Save as PDF**: Use browser's print function (Cmd/Ctrl+P)
- üìÑ **View Publication**: Navigate to full publication page
- üîó **Share URL**: Copy certificate URL for verification

## Security Features

### Server-Side Generation
- ‚úÖ Certificates generated by Firebase Functions (server-side only)
- ‚úÖ Clients cannot forge certificates
- ‚úÖ PDID collision detection (max 5 attempts)

### Verification
- ‚úÖ Certificate page queries Firestore directly
- ‚úÖ Only shows certificates for approved publications
- ‚úÖ Hash can be independently verified (data ‚Üí SHA-256)

### Data Integrity
- ‚úÖ Hash includes immutable fields only
- ‚úÖ Timestamp cannot be altered
- ‚úÖ PDID is unique and collision-resistant

## Cost Analysis

**Current Implementation (HTML Certificates)**:
- Function execution: ~50ms per certificate
- Storage: 0 bytes (no files stored)
- Cost at 1000 approvals/month: **~$2-3/month**

**If PDF Generation Added (Future)**:
- Function execution: ~500ms per certificate
- Storage: ~100KB per PDF
- Cost at 1000 approvals/month: **~$15-20/month**

**Recommendation**: Stay with HTML (7x cheaper, instant, flexible)

## Technical Implementation

### Files Modified/Created

1. **`functions/index.js`** (lines 207-334)
   - Added `generatePDID()` function
   - Added `generateCertificateHash()` function
   - Added `exports.generateCertificateOnApproval` trigger

2. **`public/pages/certificate.html`** (new file)
   - Professional certificate design
   - Dynamic data loading from Firestore
   - Print-friendly styles

3. **`public/pages/article.html`** (lines 401-412)
   - Added "Voir le certificat" button (conditional)
   - Only shows if `publication.certificate.pdid` exists

4. **`public/js/utils/helpers.js`** (lines 111-123)
   - Added blue star badge to publication cards
   - Shows when certificate exists

### Firebase Function Deployment

```bash
cd /path/to/publiedev
firebase deploy --only functions
```

Deployed function:
- **Name**: `generateCertificateOnApproval`
- **Region**: us-central1
- **Trigger**: Firestore document update (`publications/{publicationId}`)
- **Execution**: Automatic on status change to "approved"

## Testing

### Manual Test

1. Create a test publication in Firestore
2. Set status to "pending"
3. Change status to "approved" (simulating admin approval)
4. Check that certificate object is added
5. Visit certificate URL: `/pages/certificate.html?pdid=PDID-YYYY-XXXXXX`
6. Verify all data displays correctly
7. Test print function

### Verification Test

To verify a certificate hash:

```javascript
const crypto = require('crypto');

const data = {
  pdid: "PDID-2025-X89Z2F",
  title: "My Publication",
  authorId: "user123",
  authorName: "John Doe",
  type: "app-web",
  category: "fintech",
  publishedAt: "2025-01-15T10:30:00Z",
  description: "Description here..."
};

const hash = crypto.createHash('sha256')
  .update(JSON.stringify(data))
  .digest('hex');

console.log(hash); // Should match certificate hash
```

## Future Enhancements (Phase 2)

### Potential Features
- ‚òê PDF generation via Cloud Functions (if users request it)
- ‚òê QR code on certificate linking to verification page
- ‚òê Public verification tool (`/verify?pdid=XXX`)
- ‚òê Certificate versioning for updated publications
- ‚òê IPFS hash for ultimate immutability
- ‚òê Batch certificate generation for older publications
- ‚òê Certificate revocation system (if publication removed)
- ‚òê API endpoint for third-party verification

### Analytics
- Track certificate views
- Track certificate prints/downloads
- Monitor certificate verification requests

## FAQ

**Q: Can certificates be faked?**
A: No. Certificates are generated server-side and verified against Firestore. The SHA-256 hash provides cryptographic proof.

**Q: What if I update my publication?**
A: The certificate remains unchanged. It proves the publication existed at the approval date. Updates don't affect the certificate.

**Q: Can I download the certificate as PDF?**
A: Use your browser's print function (Cmd/Ctrl+P) and select "Save as PDF". This works on all devices.

**Q: What happens if a publication is deleted?**
A: The certificate becomes inaccessible (certificate page shows "not found"). The PDID becomes available for reuse (though extremely unlikely due to collision resistance).

**Q: Can I verify a certificate's authenticity?**
A: Yes. Visit the certificate URL and check that the data matches the publication. The hash can be independently calculated from the displayed data.

## Legal Disclaimer

The certificate attests to the publication of a technological solution on PublieDev at the indicated date. It constitutes timestamped and verifiable proof of prior art. The SHA-256 cryptographic fingerprint guarantees the integrity of the certified data.

**This certificate does NOT constitute**:
- Proof of intellectual property ownership
- Proof of copyright
- Patent protection
- Legal protection against infringement

It only provides:
- ‚úÖ Proof of public disclosure at a specific date
- ‚úÖ Timestamped evidence of publication
- ‚úÖ Verifiable record of existence

## Support

For questions or issues with the certificate system:
- Email: support@publiedev.com
- GitHub Issues: https://github.com/yourrepo/issues
- Documentation: https://publiedev.com/docs/certificates

---

**Last Updated**: January 2025
**Version**: 1.0.0 (Phase 1 - HTML Certificates)
